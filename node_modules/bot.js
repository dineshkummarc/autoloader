var fs = require('fs'),
irc = require("irc"),
listeners = {};

require('plugins.js').watch();

exports.triggers = [];

var client = exports.client = new irc.Client('irc.homelien.no', 'hilde', {
    userName: 'tihihilde',
    realName: 'tihihilde',
    channels: ['#tihlde']
});

exports.addListener = function(obj, type, fn) {
    client.addListener(type, fn);
    if (!listeners[obj]) {
        listeners[obj] = [];
    }
    listeners[obj].push({
        type: type,
        fn: fn
    });
};

exports.removeListeners = function(obj) {
    listeners[obj].forEach(function(l) {
        client.removeListener(obj.type, obj.fn);
    });
};

exports.onTrigger = function(obj, triggerKey, callback) {
    this.triggers.push(triggerKey);
    var regexp = '!' + triggerKey + ' ';
    this.addListener(obj, 'message', function(from, to, msg) {
        if (msg.match(regexp)) {
            callback(from, to, msg.replace(regexp, ''));
        }
    });
};

