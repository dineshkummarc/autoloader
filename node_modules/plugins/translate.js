var bot = require('bot.js'),
http = require('http');

exports.translate = function(from, to, text, callback) {
    var options = {
        host: 'translate.google.com',
        port: 80,
        path: '/translate_a/t?client=a&text=' + escape(text) + '&sl=' + from + '&tl=' + to,
        headers: {
            'User-Agent': 'Mozilla/5.0'
        }
    };
    http.get(options, function(res) {
        res.on('data', function(data) {
            data = JSON.parse(data);
            callback(data.sentences[0].trans);
        });
    });
};

bot.onTrigger(this, 't', function(from, to, msg) {
    var words = message.split(' ');
    if (words.length > 3) {
        message = words.slice(2).join(' ');
        translate.translate(words[0], words[1], message, function(text) {
            bot.client.say(to, text);
        });
    }
}

exports.destruct = function() {
    bot.removeListeners(this);
};

